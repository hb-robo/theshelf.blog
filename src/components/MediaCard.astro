---
// src/components/MediaCard.astro
import {
  mediaColors,
  getScoreColor,
  getMediaTypeBorder,
  organizeCreatives,
  formatCreativeLine
} from "../lib/cardElements.ts";
import type { ExpandedMediaItem } from "../lib/types.ts";

export interface Props {
  itemData: ExpandedMediaItem;
}
const { itemData } = Astro.props;

const organized = organizeCreatives(itemData);
const rolesInOrder = Object.keys(organized);

const mediaBorder = getMediaTypeBorder(itemData.mediaType);
const mediaColor = mediaColors[itemData.mediaType];
let scoreColor;
if (itemData.score) {
  scoreColor = getScoreColor(itemData.score);
}

---

<article
  class={`bg-slate-50 dark:bg-slate-800 media-item border-2 ${mediaBorder} rounded-lg overflow-hidden hover:shadow-lg dark:hover:shadow-gray-200/30 transition-shadow`}
>
  <div class="flex flex-row">
    {
      itemData.coverImage && (
        <div
          class={`w-3xs md:w-48 md:min-w-48 flex items-center justify-center p-2 md:p-3 ${mediaColor} border-r-2 ${mediaBorder}`}
        >
          <img
            src={itemData.coverImage}
            alt={`Cover art for ${itemData.title}`}
            class="max-w-full max-h-48 object-contain"
          />
        </div>
      )
    }

    <div class="pt-3 pb-3 pl-4 pr-4 flex w-full flex-col justify-between">
      <div
        class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4"
      >
        <div class="flex-1">
          <h3 class="text-xl font-bold mb-1">
            {
              itemData.articleSlug ? (
                <a
                  href={`/reviews/${itemData.articleSlug}`}
                  class="hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
                >
                  {itemData.title}
                </a>
              ) : (
                itemData.title
              )
            }
          </h3>

          <div class="creatives-output mb-2 text-lg">
            {rolesInOrder.length > 0 ? (
              <ul>
                {rolesInOrder.map(role => (
                  <li class="text-gray-600 dark:text-gray-400 text-sm">
                    {formatCreativeLine(role, organized[role])}
                  </li>
                ))}
              </ul>
            ) : (
              <p>No creative information available.</p>
            )}
          </div>

          
          <p class="text-gray-500 dark:text-gray-500 text-sm flex flex-col md:flex-row">
            {
              itemData.releaseDate && (
                <span>
                  <time datetime={itemData.releaseDate}>
                    {itemData.releaseDate}
                  </time>
                </span>
              )
            }
            {
              itemData.releaseDate && itemData.genre && (
                <span class="hidden md:block mx-1 text-gray-500">
                  •
                </span>
              )
            }
            {
              itemData.genre && (
                <span>
                  {Array.isArray(itemData.genre)
                    ? itemData.genre.join(", ")
                    : itemData.genre}
                </span>
              )
            }
          </p>
        </div>
      </div>

      <!-- MediaCard footer - release date, badges -->
      <div
        class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-500 pt-3"
      >
        <div class="flex gap-2 h-8">
          {
            itemData.published && itemData.score && (
              <div
                class={`flex items-center justify-center w-5 h-5 rounded-md font-bold text-sm p-4 ${getScoreColor(Number(itemData.score))}`}
                title={`Score: ${itemData.score}/10`}
              >
                {itemData.score}
              </div>
            )
          }
          {
            itemData.published && itemData.result ? (
              <>
                {itemData.result === "made-the-shelf" && (
                  <span class="text-emerald-600 dark:text-emerald-300 inline-flex items-center gap-1">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                      class="w-5 h-5"
                    >
                      <path d="M4 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-4.703L16 20a1 1 0 0 0 1.186.77l3.912-.832a1 1 0 0 0 .77-1.186l-2.91-13.694a1 1 0 0 0-1.186-.77l-2.78.59A1 1 0 0 0 14 4h-4a1 1 0 0 0-1-1zm6 3h3v8h-3zm0 13v-3h3v3zM8 5v10H5V5zm0 12v2H5v-2zm9.332-.35l1.956-.416l.416 1.956l-1.956.416zm-.416-1.957l-1.663-7.825l1.956-.416l1.664 7.826z" />
                    </svg>
                    <span class="hidden md:block">
                      Shelved
                    </span>
                  </span>
                )}

                {itemData.result === "maybe-later" && (
                  <span class="text-yellow-500 dark:text-yellow-400 inline-flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 32 32" class="w-5 h-5">
                      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16.5 17l3 3l-3 3M12 17l3 3l-3 3M5 12h22m-6-4V4M11 8V4M7 28h18a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2"/>
                    </svg>
                    <span class="hidden md:block">
                      Deferred
                    </span>
                  </span>
                )}

                {itemData.result === "no" && (
                  <span class="text-gray-500 dark:text-gray-500 inline-flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
                      <g fill="currentColor">
                        <path d="M8.478 8.478a1 1 0 0 1 1.414 0l2.154 2.153l2.153-2.153a1 1 0 1 1 1.414 1.414l-2.153 2.154l2.153 2.153a1 1 0 0 1-1.414 1.414l-2.153-2.153l-2.154 2.153A1 1 0 0 1 8.478 14.2l2.153-2.153l-2.153-2.154a1 1 0 0 1 0-1.414"/>
                        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10s10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0a8 8 0 0 1-16 0" clip-rule="evenodd"/>
                      </g>
                    </svg>
                    <span class="hidden md:block">
                      Passed On
                    </span>
                  </span>
                )}
              </>
            ) : (
              <span class="text-gray-500 dark:text-gray-500 inline-flex items-center gap-1">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  class="w-5 h-5"
                >
                  <path d="M4 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-4.703L16 20a1 1 0 0 0 1.186.77l3.912-.832a1 1 0 0 0 .77-1.186l-2.91-13.694a1 1 0 0 0-1.186-.77l-2.78.59A1 1 0 0 0 14 4h-4a1 1 0 0 0-1-1zm6 3h3v8h-3zm0 13v-3h3v3zM8 5v10H5V5zm0 12v2H5v-2zm9.332-.35l1.956-.416l.416 1.956l-1.956.416zm-.416-1.957l-1.663-7.825l1.956-.416l1.664 7.826z" />
                </svg>
                <span class="block">Pending Review</span>
              </span>
            )
          }
        </div>
        {
          itemData.published && itemData.reviewDate && (
            <p class="text-gray-500 dark:text-gray-400 text-sm">
              <a href={`/reviews/${itemData.articleSlug}`}>Read review →</a>
            </p>
          )
        }
      </div>
    </div>
  </div>
</article>
