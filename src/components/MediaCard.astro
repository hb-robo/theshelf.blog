---
// src/components/MediaCard.astro
import { getMediaTypeBadge, getScoreBadge, formatMediaType } from '../lib/badges';

interface Props {
  title: string;
  releaseDate?: Date;
  madeTheShelf: boolean;
  shelfStatus: 'owned' | 'not-owned' | 'digital-only';
  score?: number | string;
  mediaType: 'music' | 'game' | 'film' | 'book';
  subtype?: string;
  developer?: string | string[];
  director?: string | string[];
  artist?: string | string[];
  author?: string | string[];
  genre?: string | string[];
  coverImage?: string;
  spineImage?: string;
  articleSlug?: string; // optional link to the article where this media is discussed
  reviewDate?: Date;
  published?: boolean;
}

const {
  title,
  releaseDate,
  madeTheShelf,
  shelfStatus,
  score,
  mediaType,
  subtype,
  developer,
  director,
  artist,
  author,
  genre,
  coverImage,
  spineImage,
  articleSlug,
  reviewDate,
  published
} = Astro.props;


const badges: Record<string, string> = {
  music: 'bg-blue-50 dark:bg-blue-900',
  game: 'bg-red-50 dark:bg-red-900',
  film: 'bg-yellow-50 dark:bg-yellow-900',
  book: 'bg-green-50 dark:bg-green-900',
};

function getMediaTypeIcon(type: string) {
  switch (type) {
    case "music": 
      return 'border-blue-200 dark:blue-red-400'; 
    case "game": 
      return 'border-red-200 dark:border-red-400';
    case "film": 
      return 'border-yellow-200 dark:border-yellow-400';
    case "book": 
      return 'border-green-200 dark:border-green-400';
  }
  return ""
}
---

 <article class={`media-item border ${getMediaTypeIcon(mediaType)} rounded-lg overflow-hidden hover:shadow-lg dark:hover:shadow-gray-200/30 transition-shadow`}>
  <div class="flex flex-col md:flex-row">
    {coverImage && (
      <div class={`w-full md:w-48 md:min-w-48 flex items-center justify-center p-3 ${badges[mediaType]}`}>
        <img
          src={coverImage}
          alt={`Cover art for ${title}`}
          class="max-w-full max-h-48 object-contain"
        />
      </div>
    )}

    <div class="p-5 flex w-full flex-col justify-between">
      <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4">
        <div class="flex-1">

          <h3 class="text-lg font-bold mb-1">
            {articleSlug ? (
              <a
                href={`/reviews/${articleSlug}`}
                class="hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
              >
                {title}
              </a>
            ) : (
              title
            )}
          </h3>

          <div class="mb-2">
            {developer && (
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                dev. {Array.isArray(developer) ? developer.join(', ') : developer}
                </p>
            )}
            {director && mediaType !== 'game' && (
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                dir. {Array.isArray(director) ? director.join(', ') : director}
                </p>
            )}
            {artist && (
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                {Array.isArray(artist) ? artist.join(', ') : artist}
                </p>
            )}
            {author && (
                <p class="text-gray-600 dark:text-gray-400 text-sm">
                by {Array.isArray(author) ? author.join(', ') : author}
                </p>
            )}
          </div>
 
          <p class="text-gray-500 dark:text-gray-500 text-xs">
            {releaseDate && (
              <span>
                <time datetime={releaseDate.toISOString()}>
                  {releaseDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                </time>
              </span>
            )}
            
            {genre && (
                <span>• {Array.isArray(genre) ? genre.join(', ') : genre}</span>
            )}

          </p>
        </div>

      </div>

      <!-- MediaCard footer - release date, badges -->
      <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-800 mt-4 pt-2">
        <div class="flex gap-2">
          {published && score && score !== '-' && (
            <div
              class={`flex items-center justify-center w-5 h-5 rounded-md font-bold text-sm p-4 ${getScoreBadge(
                Number(score)
              )}`}
              title={`Score: ${score}/10`}
            >
              {score}
            </div>
          )}
          {published ? (
            madeTheShelf ? (
              <span class="text-green-600 dark:text-green-300 inline-flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
                  <path d="M4 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-4.703L16 20a1 1 0 0 0 1.186.77l3.912-.832a1 1 0 0 0 .77-1.186l-2.91-13.694a1 1 0 0 0-1.186-.77l-2.78.59A1 1 0 0 0 14 4h-4a1 1 0 0 0-1-1zm6 3h3v8h-3zm0 13v-3h3v3zM8 5v10H5V5zm0 12v2H5v-2zm9.332-.35l1.956-.416l.416 1.956l-1.956.416zm-.416-1.957l-1.663-7.825l1.956-.416l1.664 7.826z"/>
                </svg>
                Made the Shelf
              </span>
            ) : (
              <span class=" text-red-500 dark:text-red-300 inline-flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
                  <g fill="currentColor">
                    <path d="M8.478 8.478a1 1 0 0 1 1.414 0l2.154 2.153l2.153-2.153a1 1 0 1 1 1.414 1.414l-2.153 2.154l2.153 2.153a1 1 0 0 1-1.414 1.414l-2.153-2.153l-2.154 2.153A1 1 0 0 1 8.478 14.2l2.153-2.153l-2.153-2.154a1 1 0 0 1 0-1.414"/>
                    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10s10-4.477 10-10S17.523 2 12 2M4 12a8 8 0 1 1 16 0a8 8 0 0 1-16 0" clip-rule="evenodd"/>
                  </g>
                </svg>
                Missed the Cut
              </span>
            )
          ) : (
            <span class="text-gray-500 dark:text-gray-500 inline-flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
                <path d="M4 3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-4.703L16 20a1 1 0 0 0 1.186.77l3.912-.832a1 1 0 0 0 .77-1.186l-2.91-13.694a1 1 0 0 0-1.186-.77l-2.78.59A1 1 0 0 0 14 4h-4a1 1 0 0 0-1-1zm6 3h3v8h-3zm0 13v-3h3v3zM8 5v10H5V5zm0 12v2H5v-2zm9.332-.35l1.956-.416l.416 1.956l-1.956.416zm-.416-1.957l-1.663-7.825l1.956-.416l1.664 7.826z"/>
              </svg>
              Owned, Unreviewed
            </span>
          )}
        </div>
        {published && reviewDate && (
          <p class="text-gray-500 dark:text-gray-500 text-xs">
            <a href={`/reviews/${articleSlug}`}>Read review →</a>
          </p>
        )}
      </div>
    </div>
  </div>
</article>
