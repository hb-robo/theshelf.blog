---
// src/pages/index.astro
import BaseLayout from "../layouts/BaseLayout.astro";
import ReviewCard from "../components/ReviewCard.astro";
import { getCollection } from "astro:content";
import type { ExpandedMediaItem } from "../lib/types";
import { getExpandedMediaList } from "../lib/expandMediaItems";

// Get the 5 most recent reviews
const allReviews = await getCollection("reviews");
const publishedReviews = allReviews.filter((r) => r.data.published);
const recentReviews = publishedReviews
  .sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  )
  .slice(0, 5);

const expandedMediaList: ExpandedMediaItem[] = await getExpandedMediaList();

// Live stats
const totalReviews: number = publishedReviews.length;
var totalMedia: number = expandedMediaList.length;
var totalOnShelf: number = expandedMediaList.filter(
  (m) => (m.published && m.result === 'made-the-shelf')
).length;
const approvalRate =
  totalReviews > 0 ? Math.round((totalOnShelf / totalMedia) * 100) : 0;
---

<BaseLayout title="theshelf.blog", bigNav>
  <!-- Hero Section -->
  <section class="border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900">
    <div class="max-w-4xl mx-auto px-4 py-16 md:py-10">
      <div class="max-w-2xl">

        <p class="text-xl md:text-2xl  mb-8">
          Writing about creative works with a physical constraint -<br />if it
          speaks to me, it earns a place on the shelf.
        </p>
        <div class="flex flex-wrap gap-4">
          <a
            href="/shelf"
            class="px-6 py-3 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 rounded-lg font-medium hover:opacity-90 transition-opacity"
          >
            View the shelf
          </a>
          <a
            href="/about"
            class="inline-block px-6 py-3 border border-gray-300dark:text-gray-100 dark:text-gray-100 dark:border-gray-700 rounded-lg font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
          >
            About the concept
          </a>
          <a
            href="/reviews"
            class="px-6 py-3 border border-gray-300 dark:border-gray-700 rounded-lg font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
          >
            All writing
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Overview (Optional - shows off the data) -->
  <section
    class=" "
  >
    <div class="max-w-4xl mx-auto px-4 py-12">
      <div
        class="flex items-center justify-between border-b-2 border-stone-900 pb-4 mb-8"
      >
        <h2
          class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100"
        >
          some numbers
        </h2>
        <a
          href="/stats"
          class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
        >
          More data →
        </a>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 font-mono">
        <div class="text-center">
          <div
            class="text-3xl md:text-4xl font-bold mb-2 text-gray-900 dark:text-gray-100"
          >
            {totalReviews}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            total reviews
          </div>
        </div>
        <div class="text-center">
          <div
            class="text-3xl md:text-4xl font-bold mb-2 text-gray-900 dark:text-gray-100"
          >
            {totalMedia}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            works covered
          </div>
        </div>
        <div class="text-center">
          <div
            class="text-3xl md:text-4xl font-bold mb-2 text-gray-900 dark:text-gray-100"
          >
            {totalOnShelf}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            items made the shelf
          </div>
        </div>
        <div class="text-center">
          <div
            class="text-3xl md:text-4xl font-bold mb-2 text-gray-900 dark:text-gray-100"
          >
            {approvalRate}%
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            made the cut
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Recent Reviews -->
  <section class="max-w-4xl mx-auto px-4 py-16">
    <div
      class="flex items-center justify-between border-b-2 border-stone-900 pb-4 mb-8"
    >
      <h2
        class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100"
      >
        recent thoughts
      </h2>
      <a
        href="/reviews"
        class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
      >
        View all →
      </a>
    </div>

    <div class="space-y-6">
      {recentReviews.map((review) => <ReviewCard itemData={review} />)}
    </div>
  </section>

</BaseLayout>
